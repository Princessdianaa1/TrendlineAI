<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Budget Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --accent-primary: #3b82f6;
            --accent-secondary: #8b5cf6;
            --accent-success: #10b981;
            --accent-danger: #ef4444;
            --border-color: #334155;
            --shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 20px;
        }

        .container { max-width: 1600px; margin: 0 auto; }

        .header {
            background: var(--bg-secondary);
            padding: 20px 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2em;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .card h3 {
            color: var(--text-muted);
            font-size: 0.9em;
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .card .amount {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .card.income .amount { color: var(--accent-success); }
        .card.expense .amount { color: var(--accent-danger); }
        .card.balance .amount { color: var(--accent-primary); }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 18px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1em;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-primary);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card h2 {
            color: var(--text-primary);
            margin-bottom: 25px;
            font-size: 1.4em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--bg-tertiary);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .income-row { color: var(--accent-success); font-weight: 600; }
        .expense-row { color: var(--accent-danger); font-weight: 600; }

        .delete-btn {
            background: var(--accent-danger);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
        }

        @media (max-width: 1200px) {
            .main-grid { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Smart Budget Tracker</h1>
            <button class="btn btn-secondary" onclick="goHome()">‚Üê Back</button>
        </div>

        <div class="summary-cards">
            <div class="card income">
                <h3>Total Income</h3>
                <div class="amount" id="totalIncome">‚Çπ0</div>
            </div>
            <div class="card expense">
                <h3>Total Expenses</h3>
                <div class="amount" id="totalExpenses">‚Çπ0</div>
            </div>
            <div class="card balance">
                <h3>Net Balance</h3>
                <div class="amount" id="netBalance">‚Çπ0</div>
            </div>
        </div>

        <div class="main-grid">
            <div class="card">
                <h2>Add Entry</h2>
                <form id="entryForm" onsubmit="addEntry(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Type</label>
                            <select id="type" required>
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <select id="category" required>
                                <option value="Salary">Salary</option>
                                <option value="Freelance">Freelance</option>
                                <option value="Investment">Investment</option>
                                <option value="Food">Food</option>
                                <option value="Transport">Transport</option>
                                <option value="Shopping">Shopping</option>
                                <option value="Bills">Bills</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Education">Education</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Amount (‚Çπ)</label>
                            <input type="number" id="amount" step="0.01" required min="0">
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="date" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="description" rows="2"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Add Entry</button>
                </form>
            </div>

            <div class="card">
                <h2>Recent Entries</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="entriesBody">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px;">No entries yet</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <div class="card">
                <h2>Income vs Expenses</h2>
                <canvas id="pieChart"></canvas>
            </div>
            <div class="card">
                <h2>Category Breakdown</h2>
                <canvas id="barChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080/api/budget';
        const userId = localStorage.getItem('userId');
        let entries = [];
        let pieChart, barChart;

        if (!userId) {
            alert('Please login first!');
            window.location.href = 'index.html';
        }

        document.getElementById('date').valueAsDate = new Date();

        async function addEntry(event) {
            event.preventDefault();
            
            const entry = {
                userId: parseInt(userId),
                type: document.getElementById('type').value,
                category: document.getElementById('category').value,
                amount: parseFloat(document.getElementById('amount').value),
                entryDate: document.getElementById('date').value,
                description: document.getElementById('description').value
            };

            try {
                const response = await fetch(`${API_URL}/entry`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(entry)
                });

                if (response.ok) {
                    entries.push(await response.json());
                    updateUI();
                    document.getElementById('entryForm').reset();
                    document.getElementById('date').valueAsDate = new Date();
                    alert('‚úÖ Entry added!');
                }
            } catch (error) {
                entry.id = Date.now();
                entries.push(entry);
                localStorage.setItem('budgetEntries', JSON.stringify(entries));
                updateUI();
                document.getElementById('entryForm').reset();
                document.getElementById('date').valueAsDate = new Date();
                alert('‚úÖ Entry added (saved locally)');
            }
        }

        async function loadEntries() {
            try {
                const response = await fetch(`${API_URL}/entries/${userId}`);
                if (response.ok) {
                    entries = await response.json();
                    updateUI();
                }
            } catch (error) {
                const stored = localStorage.getItem('budgetEntries');
                if (stored) {
                    entries = JSON.parse(stored);
                    updateUI();
                }
            }
        }

        function updateUI() {
            const income = entries.filter(e => e.type === 'income').reduce((sum, e) => sum + parseFloat(e.amount), 0);
            const expenses = entries.filter(e => e.type === 'expense').reduce((sum, e) => sum + parseFloat(e.amount), 0);

            document.getElementById('totalIncome').textContent = '‚Çπ' + income.toLocaleString('en-IN');
            document.getElementById('totalExpenses').textContent = '‚Çπ' + expenses.toLocaleString('en-IN');
            document.getElementById('netBalance').textContent = '‚Çπ' + (income - expenses).toLocaleString('en-IN');

            const tbody = document.getElementById('entriesBody');
            if (entries.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px;">No entries yet</td></tr>';
            } else {
                tbody.innerHTML = [...entries].reverse().slice(0, 10).map(e => `
                    <tr>
                        <td>${e.entryDate}</td>
                        <td style="text-transform: capitalize;">${e.type}</td>
                        <td>${e.category}</td>
                        <td class="${e.type}-row">‚Çπ${parseFloat(e.amount).toLocaleString('en-IN')}</td>
                        <td><button class="delete-btn" onclick="deleteEntry(${e.id})">Del</button></td>
                    </tr>
                `).join('');
            }

            updateCharts(income, expenses);
        }

        function updateCharts(income, expenses) {
            const ctx1 = document.getElementById('pieChart').getContext('2d');
            if (pieChart) pieChart.destroy();
            pieChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Income', 'Expenses'],
                    datasets: [{
                        data: [income, expenses],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#cbd5e1' }
                        }
                    }
                }
            });

            const categoryData = {};
            entries.forEach(e => {
                categoryData[e.category] = (categoryData[e.category] || 0) + parseFloat(e.amount);
            });

            const ctx2 = document.getElementById('barChart').getContext('2d');
            if (barChart) barChart.destroy();
            barChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: Object.keys(categoryData),
                    datasets: [{
                        label: 'Amount (‚Çπ)',
                        data: Object.values(categoryData),
                        backgroundColor: '#3b82f6'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            ticks: { color: '#cbd5e1' },
                            grid: { color: '#334155' }
                        },
                        x: {
                            ticks: { color: '#cbd5e1' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        async function deleteEntry(id) {
            if (!confirm('Delete this entry?')) return;
            try {
                await fetch(`${API_URL}/entry/${id}`, { method: 'DELETE' });
                entries = entries.filter(e => e.id !== id);
                updateUI();
            } catch (error) {
                entries = entries.filter(e => e.id !== id);
                localStorage.setItem('budgetEntries', JSON.stringify(entries));
                updateUI();
            }
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        loadEntries();
    </script>
</body>
</html>